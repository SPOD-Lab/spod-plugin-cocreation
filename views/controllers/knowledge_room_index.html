<link rel="import" href="{$components_url}bower_components/paper-drawer-panel/paper-drawer-panel.html">
<link rel="import" href="{$components_url}bower_components/paper-toolbar/paper-toolbar.html">
<link rel="import" href="{$components_url}bower_components/paper-icon-button/paper-icon-button.html">
<link rel="import" href="{$components_url}bower_components/iron-icons/iron-icons.html">
<link rel="import" href="{$components_url}bower_components/iron-pages/iron-pages.html">
<link rel="import" href="{$components_url}bower_components/paper-scroll-header-panel/paper-scroll-header-panel.html">
<link rel="import" href="{$components_url}bower_components/paper-fab/paper-fab.html">
<link rel="import" href="{$components_url}bower_components/paper-fab-transitions/paper-fab-speed-dial.html">
<link rel="import" href="{$components_url}bower_components/paper-menu/paper-menu.html">
<link rel="import" href="{$components_url}bower_components/paper-item/paper-item.html">
<link rel="import" href="{$components_url}bower_components/paper-tabs/paper-tabs.html">
<link rel="import" href="{$components_url}bower_components/paper-material/paper-material.html">
<link rel="import" href="{$components_url}bower_components/paper-toast/paper-toast.html">

<link rel="import" href="{$components_url}controllets/paper-card-controllet/paper-card-controllet.html"/>
<link rel="import" href="{$components_url}controllets/search-panel-controllet/search-panel-controllet.html"/>
<link rel="import" href="{$components_url}controllets/page-slider-controllet/page-slider-controllet.html"/>
<link rel="import" href="{$components_url}controllets/postit-container-controllet/postit-container-controllet.html"/>
<!--<link rel="import" href="{$components_url}controllets/dataset-selection-controllet/dataset-selection-controllet.html"/>-->
<link rel="import" href="{$components_url}controllets/select-dataset-controllet/select-dataset-controllet.html"/>
<link rel="import" href="{$components_url}controllets/select-data-controllet/select-data-controllet.html"/>

<link rel="import" href="{$components_url}controllets/document-card-controllet/document-card-controllet.html"/>

<link rel="import" href="{$components_url}bower_components/paper-card/paper-card.html">
<link rel="import" href="{$components_url}bower_components/paper-button/paper-button.html">
<link rel="import" href="{$components_url}bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="{$components_url}bower_components/paper-styles/color.html">

<script src="{$components_url}locales/controllet_ln.js" type="text/javascript"></script>
<script src="{$components_url}locales/paper_card_controllet_ln.js" type="text/javascript"></script>

<link rel="import" href="{$components_url}controllets/page-slider-controllet/page-slider-controllet.html"/>
<link rel="import" href="{$components_url}controllets/postit-container-controllet/postit-container-controllet.html"/>

<!-- DATALET -->
<link rel="import" href="{$components_url}datalets/areachart-datalet/areachart-datalet.html">
<!--<link rel="import" href="{$components_url}datalets/areachart_stacked-datalet/areachart_stacked-datalet.html">-->
<link rel="import" href="{$components_url}datalets/barchart-datalet/barchart-datalet.html">
<!--<link rel="import" href="{$components_url}datalets/barchart_stacked-datalet/barchart_stacked-datalet.html">-->
<link rel="import" href="{$components_url}datalets/bubblechart-datalet/bubblechart-datalet.html">
<link rel="import" href="{$components_url}datalets/columnchart-datalet/columnchart-datalet.html">
<!--<link rel="import" href="{$components_url}datalets/columnchart_stacked-datalet/columnchart_stacked-datalet.html">-->
<link rel="import" href="{$components_url}datalets/datatable-datalet/datatable-datalet.html">
<link rel="import" href="{$components_url}datalets/leafletjs-datalet/leafletjs-datalet.html">
<link rel="import" href="{$components_url}datalets/linechart-datalet/linechart-datalet.html">
<link rel="import" href="{$components_url}datalets/heatmap-datalet/heatmap-datalet.html">
<link rel="import" href="{$components_url}datalets/piechart-datalet/piechart-datalet.html">
<link rel="import" href="{$components_url}datalets/scatterchart-datalet/scatterchart-datalet.html">
<link rel="import" href="{$components_url}datalets/treemap-datalet/treemap-datalet.html">

<script src="https://cdn.socket.io/socket.io-1.2.0.js"></script>

{literal}
<style is="custom-style">
    paper-toolbar.toolbar-main
    {
        --paper-toolbar-background:#2196F3;
        -moz-box-shadow: 0 0 20px 5px #999;
        -webkit-box-shadow: 0 0 20px 5px #999;
    }
</style>

<style>
    paper-fab.add-paper-fab {
        position: absolute;
        bottom: 25px;
        right: 50px;
        --paper-fab-background:#2196F3;
    }

    paper-fab-speed-dial.add-paper-fab {
        position: absolute;
        bottom: 45px;
        right: 40px;
    }

    paper-fab{
        --paper-fab-background:#2196F3;
    }

    body .floatbox_canvas .floatbox_container {
        margin-top: 50px;
    }

    .section{
        width: 50%;
        margin: 15px;
    }

    .modePages{
        position: relative;
    }

   /* paper-tabs{
        width: 50%;
        position: fixed;
        bottom: 0;
        left:0;
        font-family: 'Roboto', 'Helvetica Neue', Helvetica, Arial, sans-serif;
        font-size: 16px;
        font-weight: bold;
        background-color: #B6B6B6;
        --paper-tabs-selection-bar-color: #2196F3;

    }
    paper-tab {
        transition: all 1.0s;
    }

    paper-tab.iron-selected {
        background-color: #2196F3;
    }

    paper-tab:hover {
        /!*color: #2196F3;*!/
    }

    paper-tab[disabled] {
        color: #B6B6B6;
    }*/

    paper-tabs#cocreation_tab {
        width: 50%;
        position: fixed;
        bottom: 2px;
        left: 2px;
    }

    paper-tabs#data_tab {
        width: 50%;
        position: fixed;
        bottom: 2px;
        left: 2px;
    }

    paper-tabs {
        background: #B6B6B6;
    }

    paper-tab {
        font-weight: 700;
        border-right: 2px solid #FFFFFF;
    }

    paper-tab:nth-last-child(2) {
        border-right: 0;
    }

    paper-tab.iron-selected {
        color: #FFFFFF;
        background: #2196F3;;
    }

    paper-tab:not(.iron-selected):hover {
        color: #2196F3;
    }

    h5#mode{
        color: #ffffff;
        margin-left: 20px;
        position:  relative;
        float:left;
    }

    search-panel-controllet{
        position : absolute;
        right: 10px;
        top: 10px;
    }

    #grid-container{
        height: 80vh;
        position: relative;
        padding-right : 20px;
        overflow: auto;
        margin-top: 10px;
    }

    neon-animatable{
        margin-top: 10px;
    }

    #dialog_info {
        border: 2px solid #2196F3;
        background-color: #E0E0E0;
        height: 80vh;
        width: 80vh;
        padding: 20px;
        overflow: auto;
    }

    #dialog_content{
        position: relative;
    }

    .tabpage{
        background-color:#e8e8e8;
        width: 100%;
        height: 100%;
    }

    .grid
    {
        width: 100%;
        z-index: 0;
        margin-top : 20px;
    }

    .grid:after {
        content: '';
        display: block;
        clear: both;
    }

    .grid-item {
        float: left;
        position: relative;
        overflow: auto;
        /*margin: 10px;*/
    }

    document-card-controllet{
        width: 100%;
    }

    div.leaflet-control-zoom.leaflet-bar.leaflet-control{
        z-index:0;
    }

    #addDataset{
        position: absolute;
        top: -60px;
        right: 30px;
    }

    #datalets_slider_container{
        padding: 10px;
        height: 72vh;
        background-color:#ffffff;
        width: 50%;
        overflow: hidden;
    }

    .datalet-container{
        position: relative;
        overflow: hidden;
        height: 63vh;
        width: 100%;
    }

    #addDatalet{
        position: fixed;
        bottom: 50px;
        right: 30px;
    }

    neon-animatable{
        width: 100%;
    }

    #base_datalet_spin{
        position: absolute;
        top: 25%;
        left: 35%;
    }

    .ow_preloader_content{
        height: 68vh;
        top: 23%;
    }

    #overlay{
        z-index: 1;
        position:absolute;
        top:0;
        left:0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }

    #info_close_button{
        z-index: 1;
        color: #fff;
        box-shadow: 0 5px 11px 0 rgba(0, 0, 0, 0.18), 0 4px 15px 0 rgba(0, 0, 0, 0.15);
        -webkit-transition: 0.2s ease-out;
        -moz-transition: 0.2s ease-out;
        -o-transition: 0.2s ease-out;
        transition: 0.2s ease-out;
        cursor: pointer;
        background-color: #00BCD4;
        float: right;
        top: 20px;
    }

    .cocreation_view_modes_button{
        margin-right: 20px;
    }

    paper-fab#cc_mode_1 iron-icon{
        -o-transform:rotate(90deg);
        -webkit-transform:rotate(90deg);
        -moz-transform:rotate(90deg);
    }

</style>

{/literal}

<template id="room" is="dom-bind">

    {if $isMember == false}
    <div id="overlay">
        <h1 style="position: relative; top: 25%; left: 10%;">{text key="cocreation+concreation_not_member"}</h1>
    </div>
    {/if}
    {if $isMember == true}

       <paper-drawer-panel force-narrow>

        <div drawer>

            <paper-toolbar class="toolbar-drawer">
                <div class="title">MODE</div>
            </paper-toolbar>

            <paper-menu selected="[[selectedMode]]">
               <paper-item id="0" on-tap="_onModeChange">{text key="cocreation+room_menu_data"}</paper-item>
               <paper-item id="1" on-tap="_onModeChange">{text key="cocreation+room_menu_cocreation"}</paper-item>
               <paper-item id="2">{text key="cocreation+room_menu_tools"}</paper-item>
            </paper-menu>

        </div>

        <div main class="fullbleed layout vertical" style="background-color:#e8e8e8;height: 113vh;">

            <paper-toolbar class="toolbar-main">
                <paper-icon-button paper-drawer-toggle icon="menu"></paper-icon-button>
                <paper-icon-button title='{text key="cocreation+room_info_tooltip"}' id="info_room_button" icon="info" on-tap="_openInfo"></paper-icon-button>
                <div class="title">
                    <h5 id="mode">{text key="cocreation+room_menu_cocreation"}</h5>
                </div>
                <!--<search-panel-controllet right-direction="true"></search-panel-controllet>-->
                <div id="cocreation_view_modes" class="layout horizontal">
                    <paper-fab  title='{text key="cocreation+room_cc_document"}' id="cc_mode_0" class="cocreation_view_modes_button" mini icon="description" on-click="_handleCcModeClick" style="background-color:#B6B6B6"></paper-fab>
                    <paper-fab  title='{text key="cocreation+room_cc_uniform"}' id="cc_mode_1" class="cocreation_view_modes_button" mini icon="view-agenda" on-click="_handleCcModeClick" style="background-color:#00BCD4"></paper-fab>
                    <paper-fab  title='{text key="cocreation+room_cc_datalet"}' id="cc_mode_2" class="cocreation_view_modes_button" mini icon="assessment" on-click="_handleCcModeClick" style="background-color:#B6B6B6"></paper-fab>
                </div>
            </paper-toolbar>

            <paper-scroll-header-panel class="flex" fixed>

             <iron-pages selected="[[selectedMode]]">

                 <!-- Data -->
                 <div id="data" class="modePages">
                     <iron-pages selected="[[selectedTab_data]]">
                         <!-- Entrance -->
                         <div class="layout horizontal tabpage">
                             <document-card-controllet
                                     style="width: 100%;"
                                     resource-url="{$outcome_ro_url}"
                                     class="grid-item"
                                     height=80>
                             </document-card-controllet>
                         </div>
                         <!-- Add dataset -->
                         <div id="add_dataset_container" class="layout horizontal">
                             <page-slider-controllet id="slider_dataset" style="width: 100%; margin-top: 10px;height: 81vh;overflow: scroll">
                                 <neon-animatable id="pass_1">
                                         <!--<dataset-selection-controllet id="dataset_selection"
                                                                       datasets='{$datasets_list}'>
                                         </dataset-selection-controllet>-->
                                         <select-dataset-controllet
                                             id="dataset_selection"
                                             datasets='{$datasets_list}'>
                                         </select-dataset-controllet>
                                 </neon-animatable>

                                 <neon-animatable id="pass_2">
                                     <div id="pass_2_select_data_container">
                                         <select-data-controllet id="select_data_controllet" data-url=[[dataUrl]]></select-data-controllet>
                                     </div>
                                     <paper-fab id="addDataset" icon="add" title='{text key="cocreationep+room_add_dataset"}' class="dropdown-trigger" on-click="_addDataset"></paper-fab>
                                 </neon-animatable>
                             </page-slider-controllet>
                         </div>
                         <!-- View datalibrary -->
                         <div id="data_library" class="layout horizontal">
                             {$datasets_library}
                         </div>
                         <!-- Search datasets -->
                         <div class="layout horizontal tabpage">
                             Search datasets
                         </div>
                     </iron-pages>

                     <paper-tabs id="data_tab" selected="[[selectedTab_data]]" no-bar>
                         <paper-tab noink on-click="_tabClicked_data" id="0">{text key="cocreation+room_entrance"}</paper-tab>
                         <paper-tab noink on-click="_tabClicked_data" id="1">{text key="cocreation+room_add_dataset"}</paper-tab>
                         <paper-tab noink on-click="_tabClicked_data" id="2">{text key="cocreation+room_view_datalibrary"}</paper-tab>
                         <paper-tab noink id="3">{text key="cocreation+room_search_dataset"}</paper-tab>
                     </paper-tabs>
                 </div>
                 <!-- CoCreation -->
                 <div id="cocreation" class="layout horizontal modePages">
                   <iron-pages selected="[[selectedTab_cocreation]]" class="section" id="shared_docs">
                    <!-- Explore -->
                    <div class="layout horizontal tabpage">
                        <document-card-controllet
                                user-name="{$currentUser['title']}"
                                resource-url="{$documents[0]}"
                                show-controls
                                class="grid-item"
                                height=74>
                        </document-card-controllet>
                    </div>
                    <!-- Ideas -->
                    <div class="layout horizontal tabpage">
                        <document-card-controllet
                                user-name="{$currentUser['title']}"
                                resource-url="{$documents[1]}"
                                show-controls
                                class="grid-item"
                                height=74>
                        </document-card-controllet>
                    </div>
                    <!-- Outcome -->
                    <div class="layout horizontal tabpage">
                        <document-card-controllet
                                user-name="{$currentUser['title']}"
                                resource-url="{$documents[2]}"
                                show-controls
                                class="grid-item"
                                height=74>
                        </document-card-controllet>
                    </div>
                    </iron-pages>

                    <paper-material id="datalets_slider_container" elevation="2" class="layout vertical section">
                        {if !empty($datalets_slider)}
                           {$datalets_slider}
                        {else}
                           <img id="base_datalet_spin" src="{$components_url}datalets/base-datalet/static/images/spin.svg">
                        {/if}

                    </paper-material>

                    <paper-tabs id="cocreation_tab" selected="[[selectedTab_cocreation]]" no-bar>
                       <paper-tab noink on-click="_tabClicked_cocreation" id="0">{text key="cocreation+room_explore"}</paper-tab>
                       <paper-tab noink on-click="_tabClicked_cocreation" id="1">{text key="cocreation+room_ideas"}</paper-tab>
                       <paper-tab noink on-click="_tabClicked_cocreation" id="2">{text key="cocreation+room_outcome"}</paper-tab>
                    </paper-tabs>
                </div>
                 <!-- Tools -->
                 <div id="tools" class="modePages"></div>

             </iron-pages>

            </paper-scroll-header-panel>
        </div>

    </paper-drawer-panel>

       <paper-dialog id="dialog_info">
        <paper-button id="info_close_button" dialog-confirm autofocus>close</paper-button>
        <div id="dialog_content">
            <h1>{$room->name}</h1>
            <h2>{text key="cocreation+room_owner"}</h2>
            <div class="layout horizontal" id="owner">
                <div class="ow_avatar">
                    <a href="{$owner['url']}">
                        <img alt="" src="{$owner['src']}" style="max-width: 100%;">
                    </a>
                </div>
                <div class="name" style="margin:15px">
                    <a href="{$owner['url']}">{$owner['title']}</a>
                </div>
            </div>
            <h2>{text key="cocreation+room_subject"}</h2>
            <p id="subject">{$room->subject}</p>
            <h2>{text key="cocreation+room_description"}</h2>
            <p id="description">{$room->description}</p>
            <h2>{text key="cocreation+room_goal"}</h2>
            <p id="goal">{$room->goal}</p>
            <h2>{text key="cocreation+room_period"}</h2>
            <p id="period">{$room->from} / {$room->to}</p>
            <h2>{text key="cocreation+room_members"}</h2>
            {if $ownerUserActive}
               <span class="ow_button"><input type="button" value='{text key="cocreation+room_invite_new_members_button"}' id="inviteNewMembers" onclick="room.inviteNewUsers();"></span>
            {/if}
            <div id="members_container">
               <div class="layout vertical">

                    <div class="layout horizontal">
                        <div class="ow_avatar">
                            <a href="{$owner['url']}">
                                <img alt="" src="{$owner['src']}" style="max-width: 100%;">
                            </a>
                        </div>
                        <div class="name" style="margin:15px">
                            <a href="{$owner['url']}">{$owner['title']}</a>
                        </div>
                    </div>

                   {foreach $members as $member}
                   <div class="layout horizontal">
                       <div class="ow_avatar">
                           <a href="{$member['url']}">
                               <img alt="" src="{$member['src']}" style="max-width: 100%;">
                           </a>
                       </div>
                       <div class="name" style="margin:15px">
                           <a href="{$member['url']}">{$member['title']}</a>
                       </div>
                       {if $member['isJoined'] == '0'}
                           <div class="name" style="margin:15px;margin-left: 30px;color:#cd0a0a;">
                               {text key="cocreation+room_user_not_joined_yet"}
                           </div>
                       {/if}
                   </div>
                   {/foreach}

               </div>

            </div>
        </div>
    </paper-dialog>

    <paper-toast id="syncToast" duration="0" text="">
        <div class="layout horizontal">
            <h5>{text key="cocreation+room_sync_toast"}</h5>
            <paper-button onclick="syncToast.toggle()" class="blue-button"><b>x</b></paper-button>
        </div>
        <div class="layout vertical" id="syncMessage"></div>
    </paper-toast>
   {/if}

</template>