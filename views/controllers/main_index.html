<link rel="import" href="{$components_url}controllets/cocreation-paper-card-controllet/cocreation-paper-card-controllet.html">

<link rel="import" href="{$components_url}bower_components/iron-icons/iron-icons.html">
<link rel="import" href="{$components_url}bower_components/paper-fab/paper-fab.html">
<link rel="import" href="{$components_url}bower_components/paper-toast/paper-toast.html">

<link rel="import" href="{$components_url}bower_components/paper-date-picker/paper-date-picker.html">
<link rel="import" href="{$components_url}bower_components/paper-dialog/paper-dialog.html">
<link rel="import" href="{$components_url}bower_components/paper-button/paper-button.html">

<link rel="import" href="{$components_url}bower_components/paper-fab-transitions/paper-fab-speed-dial.html">

{literal}
<style is="custom-style">



    body .floatbox_canvas .floatbox_container{ margin-top:110px; }

    cocreation-paper-card-controllet{
        /*margin: 20px;
        padding: 20px;*/
    }

    .blue-button {
        text-transform: none;
        color: #2196F3;
        margin-top: 8px;
    }

    .confirm_button{
        position: relative;
        float: right;
        margin-top: -8px;
    }

    #submit_overlay{
        z-index: 1;
        position:absolute;
        top:0;
        left:0;
        width: 100%;
        height: 100%;
        background-color: rgba(0, 0, 0, 0.4);
    }

    .dataset-list {
        position: absolute;
        top: 64px;
        right: 103px;
    }

    .room_container {
        position: relative;
        min-height: calc(100vh - 56px);
    }

    .buttons_container {
        height: 56px;
        width: 104px;
        background: transparent;
        position: fixed;
        bottom: 32px;
        right: 32px;
        z-index: 11;
        float: right;

    }

    paper-fab
    {
        --paper-fab-background:#2196F3;
        /*--paper-fab-background:#00BCD4;*/
    }

    paper-fab#view_datasets {
        float: left;
        margin-top: 8px;
    }

    paper-fab-speed-dial#add_dataset {
        float: right;
        margin-left: 48px;
    }

    paper-fab-speed-dial.add-paper-fab {
        position: absolute;
        /*top: 58px;*/
        /*right: 40px;*/
    }

</style>
{/literal}

{literal}
<script type="text/javascript">

    function addCocreationRoom(room_type)
    {
        previewFloatBox = OW.ajaxFloatBox('COCREATION_CMP_CreateRoom', {room_type : room_type} , {width:'60%', height:'475px', iconClass: 'ow_ic_add', title: ''});

    }

    setTimeout(function(){
                var roomList = document.querySelector('template[is="dom-bind"]');
                if(roomList.$.infoToast != undefined)
                   roomList.$.infoToast.show();
            }
            ,1000);

    $(document).ready(function(){
        window.addEventListener('cocreation-paper-card-controllet_delete', function(e){
            var c = confirm(OW.getLanguageText('cocreation', 'confirm_delete_room'));
            if(c == true) {
                $.post(ODE.ajax_coocreation_delete_room,
                        {
                            roomId: e.detail.roomId
                        },
                        function (data, status) {
                            data = JSON.parse(data);
                            if (data.status == "ok") {
                                OW.info(OW.getLanguageText('cocreation', 'room_delete_successful'));
                                location.reload();
                            } else {
                                OW.info(OW.getLanguageText('cocreation', 'room_delete_fail'));
                            }
                        }
                );
            }
        });
    });

</script>
{/literal}

<template id="list" is="dom-bind">

    {if $isActive == false}
        <div id="submit_overlay">
            <h1 style="position: relative; top: 25%; left: 10%;">{text key="cocreation+concreation_not_active"}</h1>
        </div>
    {/if}

    <div class=" room_container">
        {foreach $cocreation_rooms as $room}
        <cocreation-paper-card-controllet
                room-id="{$room->id}"
                name="{$room->name}"
                owner="{$room->owner}"
                from="{$room->from}"
                to="{$room->to}"
                goal="{$room->goal}"
                room-type="{$room->type}"
                {if $userId == $room->ownerId}
                is-owner
                {/if}
                room-url="{$partialRoomUrl}{$room->type}-room/{$room->id}">
         </cocreation-paper-card-controllet>
        {/foreach}

        <div class="buttons_container">
            <paper-fab-speed-dial id="add_dataset" direction="top" class="bottom-right add-paper-fab">
                <paper-fab icon="add" title='' class="dropdown-trigger"></paper-fab>
                <div class="dropdown-content">
                    <paper-fab title="Add a cocreation data room" mini icon="assessment" onclick="addCocreationRoom('data')"></paper-fab>
                    <paper-fab title="Add a cocreation knowledge room" mini icon="description" onclick="addCocreationRoom('knowledge')"></paper-fab>
                </div>
            </paper-fab-speed-dial>

            <paper-fab id="view_datasets" title="View all datasets" mini icon="view-list" onclick="window.location='/cocreation/data-room-list'"></paper-fab>
        </div>
    </div>


    <!--<paper-fab-speed-dial direction="bottom" class="bottom-right add-paper-fab">-->
        <!--<paper-fab icon="add" title='' class="dropdown-trigger"></paper-fab>-->
        <!--<div class="dropdown-content">-->
            <!--<paper-fab title="Add a cocreation data room" mini icon="assessment" onclick="addCocreationRoom('data')"></paper-fab>-->
            <!--<paper-fab title="Add a cocreation knowledge room" mini icon="description" onclick="addCocreationRoom('knowledge')"></paper-fab>-->
        <!--</div>-->
    <!--</paper-fab-speed-dial>-->

    <!--<div class="dataset-list">-->
        <!--<paper-fab title="View all datasets" mini icon="view-list" onclick="window.location='/cocreation/data-room-list'"></paper-fab>-->
    <!--</div>-->

    {if {$invitations|@count} > 0}
        <paper-toast id="infoToast" duration="0" text="">
            <div class="layout horizontal">
                <h5>{text key="cocreation+room_info_toast"}</h5>
                <paper-button onclick="infoToast.toggle()" class="blue-button"><b>x</b></paper-button>
            </div>
            <div class="layout vertical">
                {foreach $invitations as $invitation}
                <p>{$invitation}</p>
                {/foreach}
            </div>
        </paper-toast>
    {/if}

</template>